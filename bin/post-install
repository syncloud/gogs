APP_NAME = 'gogs'
USER_NAME = 'git'
SYSTEMD_NGINX_NAME = 'gogs'

import sys
from os.path import join
from subprocess import check_output

from syncloud_platform.application import api

from syncloud_platform.gaplib import fs, linux, gen

app = api.get_app_setup(APP_NAME)
app_dir = app.get_install_dir()
app_data_dir = app.get_data_dir()

linux.useradd(USER_NAME, create_home=True)
fs.chownpath(app_dir, USER_NAME, recursive=True)

gogs_executable = join(app_dir, 'gogs', 'gogs')
check_output('chmod +x {0}'.format(gogs_executable), shell=True)

log_path = join(app_data_dir, 'log')

fs.makepath(log_path)

variables = {'app_dir': app_dir, 'app_data_dir': app_data_dir}

templates_path = join(app_dir, 'templates')
config_path = join(app_dir, 'config')

gen.generate_files(templates_path, config_path, variables)

fs.chownpath(app_data_dir, USER_NAME, recursive=True)

app.add_service(SYSTEMD_NGINX_NAME)

app.register_web(3000)

